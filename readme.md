# Factorio Fotograf

[![demo image](./demo.png)](https://randacek.dev/s/m/f/protab/)

Minimalistic and simple to customize Factorio map generator for Linux.  
I assume that your Factorio folder is in `~/.factorio`

## Usage
`./run savename`  
Where `savename` is the save name. Sometimes it needs to end with `.zip` sometimes it does not. I don't know why.  

## Example
[Protab map render](https://randacek.dev/s/m/f/protab/)  
Taking the screenshots took ~1.5 minutes. Creating lower zoom levels took another 20 minutes. After that the map was 15 GB in size. Converting to jpg took 4 minutes and the final map has 3.5 GB.

## Image optimization
Command                                                                      | Description  | %save | Time
-----------------------------------------------------------------------------|--------------|-------|-----
`find dir -name "*.png" \| parallel --bar optipng -o 2 {}`                   | minify pngs  | ~30 % | slow
`find dir -name "*.png" \| parallel --bar "mogrify -format jpg {} && rm {}"` | pngs to jpgs | ~75 % | fast

Notes:
- `yay -S parallel optipng imagemagick --needed`
- `dir` is the web root that was generated by the `run` script
- If you convert the images to jpg, you need to change the first line of `script.js` from png to jpg

## Deps
Non-headless Factorio runnable by `factorio` (`yay -S factorio` or [download here](https://factorio.com/download) and then add the binary to PATH)  
`jq`, `convert`, `gcc`

## Task list
- [x] Lua mod
- [x] Image merge tool
- [x] Web
- [x] Generate lower zoom levels
- [ ] Zooming in parallel
- [ ] Position in the url
- [ ] Compatible with other mods
- [ ] Achieve optimal C code
  - [ ] Own png import & export
  - [ ] Own image resize
  - [ ] Import image bitmap straight into the final position in ram to avoid copying

